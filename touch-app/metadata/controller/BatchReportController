{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "models": [
            "Batch",
            "BatchReportPanel"
        ],
        "stores": [
            "BatchStore",
            "BatchFormStore",
            "BatchReportPanelStore"
        ],
        "views": [
            "BatchReportCarousel",
            "BatchReportPanel"
        ],
        "designer|userClassName": "BatchReportController"
    },
    "designerId": "946d268d-9ef8-4b31-8ae9-6b6b32617ea8",
    "cn": [
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "init",
                "designer|params": [
                    "application"
                ],
                "implHandler": [
                    "",
                    "this.control({",
                    "    '#selectBatchBackToolbar button[itemId=commonBackBtn]':{",
                    "        tap:function(btn, e, eOpts){",
                    "            history.go(0);",
                    "        }",
                    "    },",
                    "    '#batchReportBackToolbar button[itemId=commonBackBtn]':{",
                    "        tap:function(btn, e, eOpts){",
                    "            this.getBatchReportCarousel().previous();",
                    "        }",
                    "    },",
                    "    'batchreportcarousel searchfield[itemId=commonSearchField]':{",
                    "        action:this.doSearchBatchForm",
                    "    }",
                    "});"
                ]
            },
            "designerId": "1d1a4040-b7b9-4934-a0cb-a2588e1c8905"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "batchReportCarousel",
                "selector": "batchreportcarousel"
            },
            "designerId": "2bdb0665-7ce0-496e-a893-9aa9d0582c90"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "doSearchBatchForm",
                "designer|params": [
                    "field, e, eOpts"
                ],
                "implHandler": [
                    "var that=this;",
                    "this.getBatchReportCarousel().setMasked({xtype:'loadmask',message:lang['default.message.load']});",
                    "Ext.getStore('BatchFormStore').load({",
                    "    params:{",
                    "        'id':field.getValue()",
                    "    },",
                    "    waitMsg:{",
                    "        xtype:'loadmask',",
                    "        message: lang['common.message.load'] ",
                    "    },",
                    "    callback:function(records, operation, success){",
                    "",
                    "        that.getBatchReportCarousel().down('formpanel[itemId=batchForm]').setRecord(records[0]);",
                    "        that.getBatchReportCarousel().setMasked(false);",
                    "        that.showBatchReport(field.getValue());",
                    "    }",
                    "",
                    "});",
                    "",
                    "/*",
                    "batchid=this.getBatchReportCarousel().down('searchfield[itemId=commonSearchField]').getValue();",
                    "",
                    "var that=this;",
                    "",
                    "Ext.Ajax.request({",
                    "url:'/rest/batch/'+batchid,",
                    "method :'GET',",
                    "callback:function(callback,success,data){",
                    "var batchdata=Ext.decode(data.responseText).batchInstanceList;",
                    "console.log(batchdata);",
                    "that.getBatchReportCarousel().down('textfield[itemId=batchid]').setValue(batchdata.id);",
                    "that.getBatchReportCarousel().down('textfield[itemId=batchitem]').setValue(batchdata.item.id);",
                    "that.getBatchReportCarousel().down('textfield[itemId=batchname]').setValue(batchdata.name);",
                    "that.getBatchReportCarousel().down('textfield[itemId=batchexpectQty]').setValue(batchdata.expectQty);",
                    "that.showBatchReport(batchid);",
                    "}",
                    "});",
                    "",
                    "*/",
                    ""
                ]
            },
            "designerId": "2cf944a0-dbe2-4966-a212-d1ccb56b4f19"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "showBatchReport",
                "designer|params": [
                    "batchid"
                ],
                "implHandler": [
                    "console.log('BatchReportCarouselController-showBatchReport');",
                    "",
                    "",
                    "var store=Ext.getStore('BatchReportPanelStore');",
                    "",
                    "var that=this;",
                    "this.getBatchReportCarousel().setMasked({xtype:'loadmask',message:lang['default.message.load']});",
                    "",
                    "store.load({",
                    "    params:{",
                    "        'batch.id':batchid",
                    "    },",
                    "    waitMsg:{",
                    "        xtype:'loadmask',",
                    "        message: lang['common.message.load'] ",
                    "    },",
                    "    callback:function(records, operation, success){",
                    "",
                    "        for(var i=0;i<records.length;i++){",
                    "",
                    "            //注意：元件需加入controller view中 否則add會有錯",
                    "            var panel=that.getBatchReportCarousel().add({xtype:'batchreportpanel'});",
                    "",
                    "            panel.down('toolbar[itemId=batchReportBackToolbar]').setTitle(records[i].data['batchReport__title']);",
                    "",
                    "            var form=panel.down('formpanel[itemId=batchReportDetForm]');",
                    "",
                    "            var brd=records[i].data.batchReportDets;",
                    "",
                    "            for(var j=0; j<brd.length; j++){",
                    "",
                    "                var field=null;",
                    "",
                    "                switch(brd[j].reportParams.param.paramType.name){",
                    "                    case \"INTEGER\":",
                    "                    field={",
                    "                        xtype: 'numberfield'",
                    "                    };",
                    "                    break;",
                    "                    case \"STRING\":",
                    "                    field={",
                    "                        xtype: 'textfield'",
                    "                    };",
                    "                    break;",
                    "                    case \"BOOLEAN\":",
                    "                    field={",
                    "                        xtype: 'textfield'",
                    "                    };",
                    "                    break;",
                    "                    case \"LIST\":",
                    "                    //field={",
                    "                    //    xtype: 'triggerfield'",
                    "                    //};",
                    "                    break;",
                    "                    default:",
                    "                    console.log('error: not defined paramType');",
                    "                    break;",
                    "                }",
                    "",
                    "                field.flex=1;",
                    "                field.label= brd[j].reportParams.param.title;",
                    "                field.name = brd[j].id;",
                    "                field.readOnly=true;",
                    "",
                    "                if(brd[j].value==null || brd[j].value==''){",
                    "                    field.value=brd[j].reportParams.param.defaultValue;",
                    "                }",
                    "                else{",
                    "                    field.value=brd[j].value;",
                    "                }",
                    "",
                    "                form.down('fieldset[itemId=dynamicFieldSet]').add(field);            ",
                    "",
                    "            }//end for brd",
                    "",
                    "            //that.getBatchParamsCarousel().setActiveItem(that.getBatchParamsCarousel().down('panel[itemId=batchRouteParamsPanel]'));",
                    "",
                    "            // display Image",
                    "            //var commonImageUploader= that.getBatchParamsCarousel().down('commonimageuploader');",
                    "            //commonImageUploader.setDomainName('batchRoute');",
                    "            //commonImageUploader.setDomainId(record.data['id']);",
                    "            //commonImageUploader.showImage();",
                    "        }//end for records",
                    "",
                    "        that.getBatchReportCarousel().setMasked(false);",
                    "",
                    "    }//end callback",
                    "",
                    "});",
                    "",
                    "/*",
                    "var batchcarousel=this.getBatchReportCarousel();",
                    "var that=this;",
                    "",
                    "",
                    "Ext.Ajax.request({",
                    "url:'/rest/batchReportDet/',",
                    "method :'GET',",
                    "params:{",
                    "batchid:batchid",
                    "},",
                    "success:function(resp){",
                    "var reportdata=Ext.decode(resp.responseText).batchReportDetInstanceList;",
                    "",
                    "//console.log(batchcarousel.getInnerItems().length);",
                    "var itemsLength=batchcarousel.getInnerItems().length;",
                    "var itemsob=batchcarousel.getInnerItems();",
                    "//remove",
                    "for(j=itemsLength-1;j>0;j--){",
                    "    //console.log(batchcarousel.getInnerItems()[0]);",
                    "    //console.log(items[j]);",
                    "    batchcarousel.remove(itemsob[j]);",
                    "}",
                    "//console.log(batchcarousel.getInnerItems().length);",
                    "",
                    "//add",
                    "for(i=0;i<reportdata.length;i++){",
                    "    //console.log(reportdata[i].id);",
                    "",
                    "    var report=Ext.create('Ext.tab.Panel',{",
                    "        items:[",
                    "        {",
                    "            xtype: 'formpanel',",
                    "            title: reportdata[i].reportParams.report.title,",
                    "            items: [",
                    "            {",
                    "                xtype: 'fieldset',",
                    "                items: [",
                    "                {",
                    "                    xtype: 'textfield',",
                    "                    label: 'Param_title:',",
                    "                    readOnly:true,",
                    "                    labelWidth:120,",
                    "                    value: reportdata[i].reportParams.param.title",
                    "                },",
                    "                {",
                    "                    xtype: 'textfield',",
                    "                    label: 'Param_type:',",
                    "                    readOnly:true,",
                    "                    labelWidth:120,",
                    "                    value: reportdata[i].reportParams.param.paramType.name",
                    "                },",
                    "                {",
                    "                    xtype: 'textfield',",
                    "                    label: 'Value:',",
                    "                    readOnly:true,",
                    "                    labelWidth:120,",
                    "                    value: reportdata[i].value",
                    "                }",
                    "                ]",
                    "            }",
                    "            ]",
                    "        }",
                    "        ]",
                    "    });",
                    "    batchcarousel.add([report]);",
                    "}",
                    "//console.log(batchcarousel.getInnerItems().length);",
                    "}",
                    "});",
                    "*/"
                ]
            },
            "designerId": "f11fabcb-3597-4dba-bcc5-c498bca45e2a"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "batchReportPanel",
                "selector": "batchreportpanel"
            },
            "designerId": "62b5ba59-a0ef-472d-889e-4c4eb4180a6b"
        }
    ]
}