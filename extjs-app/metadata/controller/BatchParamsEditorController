{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "models": [
            "Batch",
            "BatchRotue",
            "BatchReportDet"
        ],
        "stores": [
            "BatchStore",
            "BatchRouteStore",
            "BatchReportDetDeepStore"
        ],
        "views": [
            "BatchParamsEditorCt",
            "BatchRouteParamsWindow"
        ],
        "designer|userClassName": "BatchParamsEditorController",
        "mixins": [
            "{",
            "\tBatchViewerCtrl: 'foodprint.controller.BatchViewerController',",
            "\tBatchRouteGridCtrl: 'foodprint.controller.BatchRouteGridController'//,",
            "    //BatchRouteParamsFormCtrl: 'foodprint.controller.BatchRouteParamsFormController'",
            "}"
        ]
    },
    "designerId": "b45ae00c-f10f-4e06-afac-1db682d3ce23",
    "cn": [
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "batchParamsEditorCt",
                "selector": "batchparamseditorct"
            },
            "designerId": "7cbf55b4-dda1-49ae-a354-396c4e269377"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "batchParamsEditor",
                "selector": "batchparamseditor"
            },
            "designerId": "7afc0ef2-5b70-47ba-b132-f491b44d9bb5"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "batchRouteGrid",
                "selector": "batchroutegrid"
            },
            "designerId": "983d1235-9083-4028-9722-5dd9162dd43f"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "batchGrid",
                "selector": "batchgrid"
            },
            "designerId": "cf2c750e-4d15-4dbb-90f1-49e81227611f"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "batchViewer",
                "selector": "batchviewer"
            },
            "designerId": "cdd2ad0f-374a-4918-b823-b5260cc22b9b"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "batchForm",
                "selector": "form"
            },
            "designerId": "1286dca8-4881-4c0e-bc69-1eaf7fd61fcf"
        },
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "init",
                "designer|params": [
                    "application"
                ],
                "implHandler": [
                    "this.control({",
                    "    'batchparamseditorct grid[itemId=batchGrid]':{",
                    "        itemdblclick:this.readBatch",
                    "    },",
                    "    'batchparamseditor grid[itemId=batchRouteGrid]':{",
                    "        itemdblclick:this.loadBatchRouteParams",
                    "    },",
                    "    'batchrouteparamswindow button[itemId=saveBtn]':{",
                    "        click:this.doSaveBatchRouteParamsForm",
                    "    }",
                    "});"
                ]
            },
            "designerId": "289ac197-fded-4411-8cea-f7e0e0141ccf"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "readBatch",
                "designer|params": [
                    "obj, record, item, index, e, eOpts"
                ],
                "implHandler": [
                    "console.log('batchParamsEditorCtrl.readBatch[dblClick]');",
                    "",
                    "this.getBatchForm().getForm().reset();",
                    "",
                    "this.getBatchParamsEditor().setActiveTab(this.getBatchViewer().up());",
                    "this.doDisplay(record);",
                    "this.getBatchParamsEditor().down('tabpanel[itemId=batchParamsTp]').setActiveTab(this.getBatchRouteGrid().up());",
                    "",
                    "this.loadBatchRoute(record);",
                    "this.loadBatchParams(record.data.id);"
                ]
            },
            "designerId": "42e9cfbf-429e-4437-a431-844f01da3692"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "loadBatchParams",
                "designer|params": [
                    "id"
                ],
                "implHandler": [
                    "console.log(\"batchParamsEditorCtrl.loadBatchParams\");",
                    "",
                    "var store=this.getStore('BatchReportDetDeepStore');",
                    "store.data.clear();",
                    "",
                    "store.load({",
                    "    params:{'batch.id':id},",
                    "    //在同一個function中",
                    "    //因為ajax的關係 ",
                    "    //若不在callback後再getRange 可能因為data仍在loading而找不到data",
                    "    callback :function(){",
                    "        //console.log(store.getRange());",
                    "    }",
                    "});",
                    "",
                    "",
                    ""
                ]
            },
            "designerId": "465ad607-e839-48b9-b294-a59e6d16552a"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "loadBatchRouteParams",
                "designer|params": [
                    "obj, record, item, index, e, eOpts"
                ],
                "implHandler": [
                    "console.log(\"batchParamsEditorCtrl.loadBatchRouteParams\");",
                    "var store=this.getStore('BatchReportDetDeepStore');",
                    "",
                    "Ext.widget('batchrouteparamswindow');",
                    "",
                    "store.clearFilter();",
                    "store.filter('reportParams.operation.id',record.data['operation.id']);",
                    "",
                    "var form=this.getBatchRouteParamsWindow().down('form[itemId=batchRouteParamsForm]');",
                    "",
                    "form.removeAll();",
                    "",
                    "form.add({",
                    "    xtype: 'hiddenfield',",
                    "    flex: 1,",
                    "    itemId: 'batch.id',",
                    "    fieldLabel: 'Batch_Id',",
                    "    value: record.data['batch.id']",
                    "});",
                    "for(var i=0;i<store.getCount();i++){",
                    "    var field=null;",
                    "    switch(store.getAt(i).data['reportParams.param.paramType']){",
                    "        case \"INTEGER\":",
                    "        field={",
                    "            xtype: 'numberfield'",
                    "        };",
                    "        break;",
                    "        case \"STRING\":",
                    "        field={",
                    "            xtype: 'textfield'",
                    "        };",
                    "        break;",
                    "        case \"BOOLEAN\":",
                    "        field={",
                    "            xtype: 'textfield'",
                    "        };",
                    "        break;",
                    "        case \"LIST\":",
                    "        //field={",
                    "        //    xtype: 'triggerfield'",
                    "        //};",
                    "        break;",
                    "        default:",
                    "        console.log('error: not defined paramType');",
                    "        break;",
                    "",
                    "    }",
                    "    field.flex=1;",
                    "    field.fieldLabel= store.getAt(i).data['reportParams.param.title'];",
                    "    field.itemId= store.getAt(i).data['reportParams.id'];",
                    "    if(store.getAt(i).data['value']==null || store.getAt(i).data['value']==''){",
                    "        field.value = store.getAt(i).data['reportParams.param.defaultValue'];",
                    "    }",
                    "    else{",
                    "        field.value = store.getAt(i).data['value'];",
                    "    }",
                    "    form.add(field);",
                    "}",
                    "",
                    "this.getBatchRouteParamsWindow().show();",
                    "",
                    ""
                ]
            },
            "designerId": "f597b3f8-c1ed-4ac6-b931-68c26157061e"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "batchRouteParamsWindow",
                "selector": "batchrouteparamswindow"
            },
            "designerId": "a094a472-92c9-449a-a513-fcd7dc230e87"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "doSaveBatchRouteParamsForm",
                "implHandler": [
                    "console.log('BatchParamsEditorCtrl.doSaveBatchRouteParamsForm');",
                    "",
                    "var that=this;",
                    "console.log(",
                    "this.getBatchRouteParamsWindow().down('form[itemId=batchRouteParamsForm]').items.getRange()",
                    "    );",
                    "this.getBatchRouteParamsWindow().down('form[itemId=batchRouteParamsForm]').submit({",
                    "    url: '/rest/batchReportDet',",
                    "    params:{",
                    "        reportParamsList: this.getBatchRouteParamsWindow().down('form[itemId=batchRouteParamsForm]').items.getRange()",
                    "           },",
                    "    submitEmptyText: false,",
                    "    waitMsg: 'Saving Data...',",
                    "    method:'PUT',",
                    "    success: function() {",
                    "        console.log('Saving Success！');",
                    "        //that.getBatchViewer().down('form[itemId=batchForm]').getForm().reset();",
                    "    },",
                    "    failure: function() {",
                    "        console.log('Saving Failed！');",
                    "        alert('儲存失敗');",
                    "        //that.getBatchEditorCt().down('button[itemId=saveBtn]').setDisabled(false);",
                    "    }",
                    "});"
                ]
            },
            "designerId": "681c6976-55d2-4a0e-8270-940ffb8cf60c"
        }
    ]
}