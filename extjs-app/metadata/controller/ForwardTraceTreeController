{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "models": [
            "TraceTree",
            "TraceSheetDetail"
        ],
        "stores": [
            "ForwardTraceTreeStore",
            "TraceSheetDetailStore"
        ],
        "views": [
            "ForwardTraceTreeView"
        ],
        "designer|userClassName": "ForwardTraceTreeController"
    },
    "designerId": "fa206857-d619-4003-b893-f4dfe5220d75",
    "cn": [
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "init",
                "designer|params": [
                    "application"
                ],
                "implHandler": [
                    "this.control({",
                    "    'forwardtracetreeview commontracetoolbar combo[itemId=commonBatchCombo]':{",
                    "        select: this.doSetRoot",
                    "    },",
                    "    'forwardtracetreeview commontracetoolbar button[itemId=commonExpandallBtn]':{",
                    "        click: this.doExpandall",
                    "    },",
                    "    'forwardtracetreeview commontracetoolbar button[itemId=commonCollapseallBtn]':{",
                    "        click: this.doCollapseall",
                    "    },",
                    "    'forwardtracetreeview treepanel[itemId=tree]':{",
                    "        beforeitemexpand: this.addExtraParamsToStore,",
                    "        celldblclick: this.doIndexSheetDetail",
                    "    },",
                    "    'forwardtracetreeview toolbar commonbackbtn':{",
                    "        click: this.activeTreeDiagram",
                    "    }",
                    "});"
                ]
            },
            "designerId": "20b74fdb-20d3-40cf-a893-4ea30bc20542"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "doSetRoot",
                "implHandler": [
                    "",
                    "console.log(\"forwardTraceTree.doSetRoot\");",
                    "",
                    "if(this.getMainTree().up().down('combo[itemId=commonBatchCombo]').getValue()!='') {",
                    "",
                    "    var treeStore=this.getMainTree().getStore();",
                    "    var that = this;",
                    "    Ext.Ajax.request({",
                    "        method: 'GET',",
                    "        url:'/traceTree/forwardTraceRoot/',",
                    "        params:{",
                    "            'id':this.getMainTree().up().down('combo[itemId=commonBatchCombo]').getValue()",
                    "        },",
                    "        success:function(response,options){",
                    "            //console.log(response);",
                    "            //console.log(options);",
                    "            var record = Ext.decode(response.responseText);",
                    "            //console.log(record);",
                    "            var root={",
                    "                'note':record.note,",
                    "                'class':record.class,",
                    "                'type':record.type,",
                    "                'name':record.name,",
                    "                'sheet':record.sheet,",
                    "                'item.name':record.item.name,",
                    "                'item.title':record.item.title,",
                    "                'item.spec':record.item.spec,",
                    "                'item.unit':record.item.unit,",
                    "                'qty':record.qty,",
                    "                'sheetDetail':record.sheetDetail,",
                    "                'children':record.children",
                    "",
                    "            };",
                    "            treeStore.setRootNode(root);",
                    "            that.getMainTree().up().down('button[itemId=commonExpandallBtn]').setDisabled(false);",
                    "            that.getMainTree().up().down('button[itemId=commonCollapseallBtn]').setDisabled(false);",
                    "        },",
                    "        callback: function(options,success,response) {",
                    "",
                    "        }",
                    "    });",
                    "",
                    "",
                    "    /*未加入批號單據之處理方式",
                    "    var batchStore=Ext.getStore('BatchShowDeepStore');",
                    "    batchStore.load({",
                    "    params:{",
                    "    'id':this.getCommonTraceToolbar().down('triggerfield[itemId=commonBatchTrigger]').getValue()",
                    "    },",
                    "    callback: function(records, operation, success) {",
                    "    //console.log(records);",
                    "    //console.log(operation);",
                    "    //console.log(success);",
                    "    var root={",
                    "        id:records[0].data.id,",
                    "        name:records[0].data.name,",
                    "        'item.title':records[0].data['item.title'],",
                    "        expectQty:records[0].data.expectQty,",
                    "        country:records[0].data.country",
                    "",
                    "    };",
                    "    treeStore.setRootNode(root);",
                    "",
                    "}",
                    "});",
                    "*/",
                    "}"
                ]
            },
            "designerId": "f4c35644-f233-4b5a-89b4-f4bb724fcf7d"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "doExpandall",
                "designer|params": [
                    "button, e, eOpts"
                ],
                "implHandler": [
                    "",
                    "var me = this.getMainTree();",
                    "var toolbar = button.up('toolbar');",
                    "",
                    "me.getEl().mask('Expanding tree...');",
                    "toolbar.disable();",
                    "",
                    "me.expandAll(function() {",
                    "    me.getEl().unmask();",
                    "    toolbar.enable();",
                    "});",
                    ""
                ]
            },
            "designerId": "ae309f68-ea26-4275-8478-a0d323e9df60"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "doCollapseall",
                "designer|params": [
                    "button, e, eOpts"
                ],
                "implHandler": [
                    "var me = this.getMainTree();",
                    "var toolbar = button.up('toolbar');",
                    "",
                    "toolbar.disable();",
                    "me.collapseAll(function() {",
                    "    toolbar.enable();",
                    "});",
                    ""
                ]
            },
            "designerId": "14ac827d-7767-47ea-a3da-384176c409fb"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "addExtraParamsToStore",
                "designer|params": [
                    "node, eOpts"
                ],
                "implHandler": [
                    "var params={};",
                    "params.class = node.data.class;",
                    "params.name = node.data.name;",
                    "this.getMainTree().getStore().getProxy().extraParams = params;"
                ]
            },
            "designerId": "9f8949c4-4960-407f-8d20-df322388795e"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "doIndexSheetDetail",
                "designer|params": [
                    "view, td, cellIndex, record, tr, rowIndex, e, eOpts"
                ],
                "implHandler": [
                    "//cellIndex:第幾欄",
                    "//record:該列資料",
                    "//rowIndex:第幾列",
                    "",
                    "if(this.getMainTree().headerCt.getHeaderAtIndex(cellIndex).dataIndex==\"sheet\"){",
                    "    if(record.raw.sheetDetail){",
                    "        this.getSheetGrid().getStore().loadData(record.raw.sheetDetail);",
                    "        this.getMainTree().up('panel[itemId=treeDiagram]').up().getLayout().setActiveItem(this.getSheetGrid().up('panel[itemId=sheetDetail]'));",
                    "",
                    "",
                    "    }",
                    "}"
                ]
            },
            "designerId": "ff748aa0-2498-4598-9e69-49a9744eb8f7"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "activeTreeDiagram",
                "implHandler": [
                    "this.getSheetGrid().getStore().removeAll();",
                    "this.getSheetGrid().up('panel[itemId=sheetDetail]').up().getLayout().setActiveItem(this.getMainTree().up('panel[itemId=treeDiagram]'));"
                ]
            },
            "designerId": "3504f527-a7d4-4421-b34d-87d2e1de70e5"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "mainTree",
                "selector": "forwardtracetreeview #tree"
            },
            "designerId": "09281429-ce53-4639-a9c5-672ae294395a"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "sheetGrid",
                "selector": "forwardtracetreeview #sheetGrid"
            },
            "designerId": "bc07fffe-0214-4011-8208-600ff58bf73f"
        }
    ]
}