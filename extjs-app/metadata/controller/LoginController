{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "models": [
            "User"
        ],
        "stores": [
            "UserStore"
        ],
        "views": [
            "LoginContainer"
        ],
        "designer|userClassName": "LoginController",
        "mixins": [
            "{",
            "    commonController: 'foodprint.controller.CommonController'",
            "}"
        ]
    },
    "designerId": "cacaa675-bcf1-4bc6-a580-889600ecf055",
    "cn": [
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "init",
                "designer|params": [
                    "application"
                ],
                "implHandler": [
                    "this.control({",
                    "    'form[itemId=loginForm] button[itemId=loginBtn]': {",
                    "        click: this.doLogin",
                    "    },",
                    "    'form[itemId=loginForm] button[itemId=QueryBtn]': {",
                    "        click: this.showQueryWin",
                    "    },",
                    "    'form[itemId=loginForm] button[itemId=cancelBtn]': {",
                    "        click: this.doReset",
                    "    },",
                    "    'form[itemId=loginForm] button[itemId=addAccountBtn]': {",
                    "        click: this.doCreate",
                    "    },",
                    "    '#mainVP #newAccount commonshowtoolbar commoncancelbtn': {",
                    "        click: this.doCancel",
                    "    },",
                    "    '#mainVP #newAccount commonshowtoolbar commondeletebtn': {",
                    "        click: this.doDelete",
                    "    },",
                    "    '#mainVP #newAccount commonshowtoolbar commonsavebtn': {",
                    "        click: this.doSave",
                    "    }",
                    "",
                    "});",
                    "",
                    "this.domainName = 'user';"
                ]
            },
            "designerId": "b2abdb09-97ac-4400-9f7a-8c29ecbdce61"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "doLogin",
                "designer|params": [
                    "btn",
                    "e",
                    "eOpts"
                ],
                "implHandler": [
                    "var form = btn.up('form').getForm();",
                    "if (form.isValid()) {",
                    "    form.submit({",
                    "        success: this.loginSuccess,",
                    "        failure: this.loginFailed",
                    "    });",
                    "}",
                    "else {",
                    "    Ext.Msg.alert('無法登入', '請檢查表單資料！');",
                    "}"
                ]
            },
            "designerId": "9759bc69-18bb-4fe5-aed9-3b22c1786c25"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "loginSuccess",
                "designer|params": [
                    "form, action"
                ],
                "implHandler": [
                    "var mainVP = Ext.getCmp('mainVP');",
                    "mainVP.removeAll();",
                    "mainVP.add({xtype: 'maincontainer'});",
                    "",
                    "Ext.get('username').update(action.result.username, false);"
                ]
            },
            "designerId": "a7f7d7d3-69bb-4fac-8b32-a07e44e47122"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "loginFailed",
                "implHandler": [
                    "Ext.Msg.alert('無法登入', '無法通過驗證！');"
                ]
            },
            "designerId": "dc1f1efb-b8f8-4755-8e8c-7bab418f2345"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "showQueryWin",
                "implHandler": [
                    ""
                ]
            },
            "designerId": "3cde850c-a6db-47fa-9ec6-fd3dbf5d6d29"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "doReset",
                "designer|params": [
                    "btn, e, eOpts"
                ],
                "implHandler": [
                    "var form = btn.up('form').getForm();",
                    "form.reset();"
                ]
            },
            "designerId": "15f4dad8-70e1-4272-80b3-6619b0cc1468"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "doCreate",
                "designer|params": [
                    "btn",
                    "e",
                    "eOpts"
                ],
                "implHandler": [
                    "var mainVP = Ext.getCmp('mainVP');",
                    "mainVP.getLayout().setActiveItem(mainVP.down('panel[itemId=newAccount]'));",
                    "",
                    "this.getMainForm().up('panel[itemId=newAccount]').down('commondeletebtn').setVisible(false);",
                    "",
                    "console.log('commonController--'+this.domainName+'--doCreate');",
                    "var that = this",
                    "var params = {}",
                    "",
                    "params[this.masterKey]=this.masterId",
                    "this.getMainForm().getForm().reset(true);",
                    "",
                    "this.getMainForm().getForm().load({",
                    "    url:this.getRoot()+'/'+this.domainName+'/create',",
                    "    params:params,",
                    "    success: function(form, action) {",
                    "        that.actionName = 'save';",
                    "    },",
                    "",
                    "    failure: function(form, action) {",
                    "        Ext.MessageBox.alert('Failure',action.result.message);",
                    "    }",
                    "",
                    "});"
                ]
            },
            "designerId": "27a44424-216c-4e6b-9bcd-d039a6d56518"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "doCancel",
                "designer|params": [
                    "btn",
                    "e",
                    "eOpts"
                ],
                "implHandler": [
                    "var mainVP = Ext.getCmp('mainVP');",
                    "mainVP.getLayout().setActiveItem(mainVP.down('logincontainer'));",
                    ""
                ]
            },
            "designerId": "d5318bd8-3067-4ce4-8b5d-ed2e27a17b90"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "mainForm",
                "selector": "mainviewport #form"
            },
            "designerId": "01d3f3eb-0a2f-4123-9c1c-a174db8cbc33"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "doSave",
                "designer|params": [
                    "btn,e,eOpts"
                ],
                "implHandler": [
                    "console.log('loginController--'+this.domainName+'--doSave');",
                    "var that = this ;",
                    "",
                    "this.submitForm(function(success){",
                    "    if(success){",
                    "",
                    "        if(that.actionName === 'save'){",
                    "            that.doCancel();",
                    "            that.actionName = '' ;",
                    "        }",
                    "    }",
                    "",
                    "});",
                    ""
                ]
            },
            "designerId": "166e8f2d-f679-485a-aa24-57ec610fe867"
        }
    ]
}