{
    "type": "Ext.panel.Panel",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "container|align": "stretch",
        "itemId": "itemViewer",
        "margin": null,
        "designer|userClassName": "ItemViewer",
        "designer|userAlias": "itemviewer",
        "layout": "vbox",
        "title": ""
    },
    "designerId": "9ce72285-96c0-40e8-825e-ee52097566ec",
    "cn": [
        {
            "type": "Ext.form.Panel",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "container|align": "stretch",
                "container|padding": 10,
                "itemId": "itemForm",
                "designer|displayName": null,
                "layout": "vbox",
                "title": "",
                "jsonSubmit": true
            },
            "designerId": "8df7dca3-8572-41d2-83cd-1cc8df18c85b",
            "cn": [
                {
                    "type": "Ext.form.field.Number",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "layout|flex": 1,
                        "fieldLabel": "id",
                        "name": "id",
                        "readOnly": true
                    },
                    "designerId": "80aadb31-9b79-45d3-8be5-34aaead792ef"
                },
                {
                    "type": "Ext.form.field.Text",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "fieldLabel": "name",
                        "name": "name"
                    },
                    "designerId": "662a24f2-885d-4fb2-befd-32efa3c3ab93"
                },
                {
                    "type": "Ext.form.field.Text",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "layout|flex": 1,
                        "fieldLabel": "title",
                        "name": "title"
                    },
                    "designerId": "028dfb25-9d20-4270-a389-4570ad8bebab"
                },
                {
                    "type": "Ext.form.field.Number",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "layout|flex": 1,
                        "fieldLabel": "dueDays",
                        "name": "dueDays"
                    },
                    "designerId": "7d9636df-9395-4d66-a867-0682fc4af078"
                },
                {
                    "type": "Ext.form.field.Date",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "layout|flex": 1,
                        "fieldLabel": "effectStartDate",
                        "name": "effectStartDate"
                    },
                    "designerId": "e34cc488-5a20-4846-830e-160e78cc6ede"
                },
                {
                    "type": "Ext.form.field.Date",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "layout|flex": 1,
                        "fieldLabel": "effectEndDate",
                        "name": "effectEndDate"
                    },
                    "designerId": "7ae00aa6-95d6-42b2-b2f8-d085a8ea207e"
                }
            ]
        },
        {
            "type": "Ext.tab.Panel",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "layout|flex": 1,
                "itemId": "itemExtendTab",
                "activeTab": 0
            },
            "designerId": "e88dbbdf-41a6-4482-a481-4e0add7d9471",
            "cn": [
                {
                    "type": "Ext.panel.Panel",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "title": "品項途程"
                    },
                    "designerId": "b0896b25-c0b8-4b57-828d-93eb117c3a64",
                    "cn": [
                        {
                            "type": "Ext.tab.Tab",
                            "reference": {
                                "name": "tabConfig",
                                "type": "object"
                            },
                            "codeClass": null,
                            "designerId": "2679cc31-c28d-4183-8a3a-73711d7ba059"
                        },
                        {
                            "type": "Ext.grid.Panel",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "height": 250,
                                "itemId": "itemRouteGrid",
                                "width": null,
                                "title": null,
                                "store": "ItemRouteStore"
                            },
                            "designerId": "a7ae62ac-9b27-475a-ae7c-2cc659253bd6",
                            "cn": [
                                {
                                    "type": "Ext.toolbar.Toolbar",
                                    "reference": {
                                        "name": "dockedItems",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "initialize": null,
                                        "dock": "top",
                                        "itemId": "stdEditorToolbar1"
                                    },
                                    "configAlternates": {
                                        "initialize": "object"
                                    },
                                    "designerId": "086a7721-0be1-473e-b6d0-18d45185e8e6",
                                    "customConfigs": [
                                        {
                                            "group": "(Custom Properties)",
                                            "name": "initialize",
                                            "type": "string"
                                        }
                                    ],
                                    "cn": [
                                        {
                                            "type": "Ext.button.Button",
                                            "reference": {
                                                "name": "items",
                                                "type": "array"
                                            },
                                            "codeClass": null,
                                            "userConfig": {
                                                "layout|flex": null,
                                                "itemId": "createBtn1",
                                                "text": "Create"
                                            },
                                            "designerId": "25d954f9-145e-4aac-86c5-a80385872156",
                                            "cn": [
                                                {
                                                    "type": "fixedfunction",
                                                    "reference": {
                                                        "name": "items",
                                                        "type": "array"
                                                    },
                                                    "codeClass": null,
                                                    "userConfig": {
                                                        "fn": "handler",
                                                        "designer|params": [
                                                            "button",
                                                            "event"
                                                        ],
                                                        "implHandler": [
                                                            "var grid = this.up().up();",
                                                            "var store = grid.getStore();",
                                                            "var form = grid.up().up().up().down('form[itemId=itemForm]');//.getForm();",
                                                            "",
                                                            "// Ext.Msg.alert(form.down('numberfield[name=id]').getValue());",
                                                            "var itemId = form.down('numberfield[name=id]').getRawValue();",
                                                            "var data = {",
                                                            "    id:'',",
                                                            "    'item.id':itemId,",
                                                            "    sequence:store.getCount()+1,",
                                                            "    workstation_id:''",
                                                            "};",
                                                            "store.insert(store.getCount(),data);"
                                                        ]
                                                    },
                                                    "designerId": "fe53f5d1-a655-44d2-b90b-391bb9a3dd27"
                                                }
                                            ]
                                        },
                                        {
                                            "type": "Ext.button.Button",
                                            "reference": {
                                                "name": "items",
                                                "type": "array"
                                            },
                                            "codeClass": null,
                                            "userConfig": {
                                                "layout|flex": null,
                                                "itemId": "deleteBtn1",
                                                "text": "Delete"
                                            },
                                            "designerId": "a544b4ca-63f5-46a8-9765-1a574a3d71cf",
                                            "cn": [
                                                {
                                                    "type": "fixedfunction",
                                                    "reference": {
                                                        "name": "items",
                                                        "type": "array"
                                                    },
                                                    "codeClass": null,
                                                    "userConfig": {
                                                        "fn": "handler",
                                                        "designer|params": [
                                                            "button",
                                                            "event"
                                                        ],
                                                        "implHandler": [
                                                            "console.log('itemRouteGrid.doStoreRemove NOT Yet Saved！');",
                                                            "var grid = this.up().up();",
                                                            "var sm = grid.getSelectionModel();",
                                                            "",
                                                            "editPlugin = grid.getPlugin('itemRouteEditPlugin');",
                                                            "editPlugin.cancelEdit();",
                                                            "",
                                                            "store=grid.getStore();",
                                                            "store.remove(sm.getSelection());",
                                                            "",
                                                            "/*",
                                                            "var grid = this.up().up();",
                                                            "var sm = grid.getSelectionModel();",
                                                            "var store = grid.getStore();",
                                                            "var activeRow = context.rowIdx;",
                                                            "var totalRow = store.getCount();",
                                                            "var itemId = store.getAt(activeRow).get('item_id');",
                                                            "var itemSquence = store.getAt(activeRow).get('squence');",
                                                            "",
                                                            "// 將totalRow縮小範圍至途程順序異動的那一種item，計算他的個數",
                                                            "var startRow = 0;",
                                                            "var itemNum = 0;",
                                                            "for (var i = 0; i < totalRow; i++) {",
                                                            "    if (store.getAt(i).get('item_id')==itemId){",
                                                            "        if (itemNum == 0){",
                                                            "            startRow = i;",
                                                            "        }",
                                                            "        itemNum++;",
                                                            "    }",
                                                            "    else if (itemNum != 0){",
                                                            "        i = totalRow; // exit for",
                                                            "    }",
                                                            "}",
                                                            "",
                                                            "if (itemSquence > activeRow-startRow+1){",
                                                            "    for(var k = activeRow+1; k < startRow+itemSquence; k++){",
                                                            "        store.getAt(k).get('squence').setValue(store.getAt(k).get('squence')-1);",
                                                            "    }",
                                                            "}",
                                                            "",
                                                            "",
                                                            "",
                                                            "console.log(\"ItemEditorCtrl.doDelete\");",
                                                            "var that=this;",
                                                            "var editor = that.getItemEditor();",
                                                            "var grid = that.getItemGrid();",
                                                            "var form = that.getItemViewer().down('form[itemId=itemForm]');",
                                                            "form.submit({",
                                                            "    url: '/rest/item',",
                                                            "    submitEmptyText: false,",
                                                            "    waitMsg: 'Deleting Data...',",
                                                            "    method:'DELETE',",
                                                            "    success: function() {",
                                                            "        console.log('Deleting Success.');",
                                                            "        editor.setActiveTab(grid.up());",
                                                            "        grid.getStore().load();",
                                                            "        form.getForm().reset();",
                                                            "    },",
                                                            "    failure: function() {",
                                                            "        console.log('Deleting Failed.');",
                                                            "    }",
                                                            "});",
                                                            "*/"
                                                        ]
                                                    },
                                                    "designerId": "0d0cc862-73b2-4371-96da-0e058246ae17"
                                                }
                                            ]
                                        },
                                        {
                                            "type": "Ext.button.Button",
                                            "reference": {
                                                "name": "items",
                                                "type": "array"
                                            },
                                            "codeClass": null,
                                            "userConfig": {
                                                "layout|flex": null,
                                                "itemId": "saveBtn1",
                                                "text": "Save"
                                            },
                                            "designerId": "c6f4c7e2-5e56-4b8b-b1de-6626d9696730",
                                            "cn": [
                                                {
                                                    "type": "fixedfunction",
                                                    "reference": {
                                                        "name": "items",
                                                        "type": "array"
                                                    },
                                                    "codeClass": null,
                                                    "userConfig": {
                                                        "fn": "handler",
                                                        "designer|params": [
                                                            "button",
                                                            "event"
                                                        ],
                                                        "implHandler": [
                                                            "var grid = this.up().up();",
                                                            "var editPlugin=grid.getPlugin('itemRouteEditPlugin');",
                                                            "editPlugin.completeEdit();",
                                                            "",
                                                            "// var sm = grid.getSelectionModel();",
                                                            "// var id = sm.getSelection()[0].get('id');",
                                                            "var form = grid.up().up().up().down('form');",
                                                            "var id = form.down('numberfield[name=id]').getValue();",
                                                            "var store = grid.getStore();",
                                                            "store.sync({",
                                                            "    url: '/rest/itemRoute',",
                                                            "    waitMsg: 'Saving Data...',",
                                                            "    success: function() {",
                                                            "        console.log('Saving Success！');",
                                                            "        Ext.MessageBox.alert('Success','資料更新完成');",
                                                            "        store.data.clear();",
                                                            "        store.load({",
                                                            "            params:{'item.id':id}",
                                                            "        });",
                                                            "    },",
                                                            "    failure: function() {",
                                                            "        console.log('Saving Failed！');",
                                                            "    }",
                                                            "});"
                                                        ]
                                                    },
                                                    "designerId": "da1aa85d-84a0-4aba-8fcb-1bbb75be6801"
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "type": "Ext.grid.View",
                                    "reference": {
                                        "name": "viewConfig",
                                        "type": "object"
                                    },
                                    "codeClass": null,
                                    "designerId": "450da850-61f2-446b-8c3a-c295dcc4c6d0"
                                },
                                {
                                    "type": "Ext.grid.column.Column",
                                    "reference": {
                                        "name": "columns",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "dataIndex": "id",
                                        "text": "Id"
                                    },
                                    "designerId": "d8750ad3-4d31-4e0a-a0b0-32893acb0a5a"
                                },
                                {
                                    "type": "Ext.grid.column.Column",
                                    "reference": {
                                        "name": "columns",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "dataIndex": "item.id",
                                        "text": "Item"
                                    },
                                    "designerId": "0488f28d-a2db-41a4-8c4f-694b80d05c2a",
                                    "cn": [
                                        {
                                            "type": "Ext.form.field.ComboBox",
                                            "reference": {
                                                "name": "editor",
                                                "type": "object"
                                            },
                                            "codeClass": null,
                                            "userConfig": {
                                                "editable": false,
                                                "displayField": "title",
                                                "hiddenName": null,
                                                "store": "ItemStore",
                                                "valueField": "id"
                                            },
                                            "designerId": "76f39f82-d443-47cb-971e-6557292e257d"
                                        }
                                    ]
                                },
                                {
                                    "type": "Ext.grid.column.Number",
                                    "reference": {
                                        "name": "columns",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "dataIndex": "sequence",
                                        "text": "Sequence",
                                        "format": "0000"
                                    },
                                    "designerId": "b8c86d4b-4e70-4287-90d0-c6d489a75c73",
                                    "cn": [
                                        {
                                            "type": "Ext.form.field.Number",
                                            "reference": {
                                                "name": "editor",
                                                "type": "object"
                                            },
                                            "codeClass": null,
                                            "designerId": "0943a68c-37b0-4259-9041-29d8a8f49a7a"
                                        }
                                    ]
                                },
                                {
                                    "type": "Ext.grid.column.Column",
                                    "reference": {
                                        "name": "columns",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "dataIndex": "workstation.id",
                                        "text": "Workstation"
                                    },
                                    "designerId": "96e889eb-3ab1-4952-936e-93e9320482d8",
                                    "cn": [
                                        {
                                            "type": "Ext.form.field.ComboBox",
                                            "reference": {
                                                "name": "editor",
                                                "type": "object"
                                            },
                                            "codeClass": null,
                                            "userConfig": {
                                                "editable": false,
                                                "displayField": "title",
                                                "hiddenName": null,
                                                "store": "WorkstationStore",
                                                "valueField": "id"
                                            },
                                            "designerId": "529b9fe9-687a-4797-b1f1-5668b8c4cac7"
                                        }
                                    ]
                                },
                                {
                                    "type": "Ext.grid.plugin.RowEditing",
                                    "reference": {
                                        "name": "plugins",
                                        "type": "array"
                                    },
                                    "codeClass": "Ext.grid.plugin.RowEditing",
                                    "userConfig": {
                                        "pluginId": "itemRouteEditPlugin"
                                    },
                                    "designerId": "7f938af9-c145-47bf-be23-7ae28675ab2a",
                                    "cn": [
                                        {
                                            "type": "basiceventbinding",
                                            "reference": {
                                                "name": "listeners",
                                                "type": "array"
                                            },
                                            "codeClass": null,
                                            "userConfig": {
                                                "fn": "onRowEditingEdit",
                                                "implHandler": [
                                                    "/*",
                                                    "var grid = context.grid;",
                                                    "//var sm = grid.getSelectionModel();",
                                                    "//var id = sm.getSelection()[0].get('id');",
                                                    "var id = context.record.data.id;",
                                                    "var store = grid.getStore();",
                                                    "store.sync({",
                                                    "    url: '/rest/itemRoute',",
                                                    "    waitMsg: 'Saving Data...',",
                                                    "    method:'PUT',",
                                                    "    success: function() {",
                                                    "        console.log('Saving Success！');",
                                                    "        store.load(",
                                                    "        {params:{id:id}}",
                                                    "        );",
                                                    "    },",
                                                    "    failure: function() {",
                                                    "        console.log('Saving Failed！');",
                                                    "    }",
                                                    "});",
                                                    "",
                                                    "",
                                                    "var grid = this.down('gridpanel[itemId=itemRouteGrid]');",
                                                    "var store = grid.getStore();",
                                                    "var activeRow = context.rowIdx; // 從0起算",
                                                    "var sequence = store.getAt(activeRow).get('sequence')",
                                                    "if (activeRow+1 != sequence){",
                                                    "    if(sequence == activeRow || sequence == activeRow+2 ){",
                                                    "        Ext.Msg.alert('Status','途程自動調整');",
                                                    "    }",
                                                    "}*/",
                                                    "",
                                                    "var grid = this.down('gridpanel[itemId=itemRouteGrid]');",
                                                    "// Ext.Msg.alert('print',grid.getItemId());",
                                                    "var sm = grid.getSelectionModel();",
                                                    "var store = grid.getStore();",
                                                    "var models = store.getRange();",
                                                    "var activeRow = context.rowIdx; // 從0起算",
                                                    "",
                                                    "if (activeRow+1 != store.getAt(activeRow).get('sequence')){",
                                                    "    //Ext.Msg.alert('Status','途程順序避錯智慧調整');",
                                                    "",
                                                    "    var totalRow = store.getCount(); // 從1起算",
                                                    "    var itemId = store.getAt(activeRow).get('item.id');",
                                                    "    var itemSequence = store.getAt(activeRow).get('sequence');",
                                                    "    /*    ",
                                                    "    // 將totalRow縮小範圍至途程順序異動的那一種item，計算他的個數",
                                                    "    var startRow = 0;",
                                                    "    var itemNum = 0;",
                                                    "    // 計算itmeNum",
                                                    "    for (var i = 0; i < totalRow; i++) {",
                                                    "        if (store.getAt(i).get('item.id')==itemId){",
                                                    "            if (itemNum == 0){",
                                                    "                startRow = i;",
                                                    "            }",
                                                    "            itemNum++;",
                                                    "        }",
                                                    "        else if (itemNum != 0){",
                                                    "            i = totalRow; // exit for",
                                                    "        }",
                                                    "    }",
                                                    "    */  ",
                                                    "    if (itemSequence < activeRow+1){",
                                                    "        for (var j = itemSequence-1; j < activeRow; j++){",
                                                    "            models[j].set('sequence', j+2);",
                                                    "        }",
                                                    "    }",
                                                    "",
                                                    "    if (itemSequence > activeRow+1){",
                                                    "        for(var k = activeRow+1; k < totalRow; k++){",
                                                    "            models[k].set('sequence', k);",
                                                    "        }",
                                                    "    }",
                                                    "    models[activeRow].set('sequence', Math.min(totalRow,itemSequence));",
                                                    "\tstore.sort();",
                                                    "}"
                                                ],
                                                "name": "edit",
                                                "scope": "me"
                                            },
                                            "designerId": "233f19cf-2770-460d-95bc-de1050843ff5"
                                        }
                                    ]
                                },
                                {
                                    "type": "Ext.selection.RowModel",
                                    "reference": {
                                        "name": "selModel",
                                        "type": "object"
                                    },
                                    "codeClass": "Ext.selection.RowModel",
                                    "designerId": "1609f475-70b6-45b5-81f8-b051037d5a71"
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}